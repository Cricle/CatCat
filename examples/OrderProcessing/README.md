# OrderProcessing - CatCat.Transit å®Œæ•´ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è®¢å•å¤„ç†ç¤ºä¾‹ï¼Œå±•ç¤ºäº† CatCat.Transit çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ¯ åŠŸèƒ½æ¼”ç¤º

### 1. CQRS åŸºç¡€
- âœ… Command å¤„ç†ï¼ˆåˆ›å»ºè®¢å•ï¼‰
- âœ… Event å‘å¸ƒï¼ˆè®¢å•åˆ›å»ºäº‹ä»¶ï¼‰
- âœ… Event å¤„ç†ï¼ˆå‘é€é€šçŸ¥ï¼‰

### 2. Saga é•¿äº‹åŠ¡ç¼–æ’
- âœ… æ”¯ä»˜å¤„ç†æ­¥éª¤
- âœ… åº“å­˜é¢„ç•™æ­¥éª¤
- âœ… å‘è´§å®‰æ’æ­¥éª¤
- âœ… è‡ªåŠ¨è¡¥å¿æœºåˆ¶

### 3. çŠ¶æ€æœº
- âœ… è®¢å•çŠ¶æ€æµè½¬
- âœ… äº‹ä»¶é©±åŠ¨è½¬æ¢
- âœ… ç”Ÿå‘½å‘¨æœŸé’©å­
- âœ… è‡ªåŠ¨çŠ¶æ€è½¬æ¢

### 4. æ€§èƒ½å’Œå¼¹æ€§
- âœ… å¹¶å‘é™æµ
- âœ… é€Ÿç‡é™åˆ¶
- âœ… å¹‚ç­‰æ€§ä¿è¯
- âœ… æ–­è·¯å™¨

## ğŸš€ è¿è¡Œç¤ºä¾‹

```bash
cd examples/OrderProcessing
dotnet run
```

## ğŸ“– é¢„æœŸè¾“å‡º

```
ğŸš€ CatCat.Transit - è®¢å•å¤„ç†ç¤ºä¾‹

ğŸ“ ç¤ºä¾‹ 1: CQRS åŸºç¡€ç”¨æ³•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

info: OrderProcessing.Handlers.CreateOrderCommandHandler[0]
      åˆ›å»ºè®¢å•: PROD-001 x 2
info: OrderProcessing.Handlers.OrderCreatedEventHandler[0]
      ğŸ“§ å‘é€è®¢å•ç¡®è®¤é‚®ä»¶: è®¢å• "12345678-..."
âœ… è®¢å•åˆ›å»ºæˆåŠŸï¼è®¢å•ID: 12345678-...

ğŸ“¦ ç¤ºä¾‹ 2: Saga é•¿äº‹åŠ¡ç¼–æ’
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”„ å¼€å§‹æ‰§è¡Œ Saga (CorrelationId: abcd1234-...)...
info: OrderProcessing.PaymentService[0]
      ğŸ’³ å¤„ç†æ”¯ä»˜: $199.98 (è®¢å• 12345678-...)
info: OrderProcessing.InventoryService[0]
      ğŸ“¦ é¢„ç•™åº“å­˜: PROD-001 x 2
info: OrderProcessing.ShippingService[0]
      ğŸšš å®‰æ’å‘è´§: PROD-001 x 2, å¿«é€’å•å·: TRACK-...
âœ… Saga æ‰§è¡ŒæˆåŠŸï¼
   - æ”¯ä»˜å·²å¤„ç†: True
   - åº“å­˜å·²é¢„ç•™: True
   - å‘è´§å·²å®‰æ’: True

ğŸ”„ ç¤ºä¾‹ 3: è®¢å•çŠ¶æ€æœº
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ è®¢å•ID: 87654321-...
ğŸ“Š åˆå§‹çŠ¶æ€: New

â¡ï¸  ä¸‹å• -> çŠ¶æ€: PaymentPending
â¡ï¸  æ”¯ä»˜ç¡®è®¤ -> çŠ¶æ€: PaymentConfirmed
â¡ï¸  è‡ªåŠ¨å¤„ç† -> çŠ¶æ€: Processing
â¡ï¸  å‘è´§ -> çŠ¶æ€: Shipped

âœ… çŠ¶æ€æœºæµè½¬å®Œæˆï¼æœ€ç»ˆçŠ¶æ€: Shipped

âš¡ ç¤ºä¾‹ 4: æ€§èƒ½å’Œå¼¹æ€§ç»„ä»¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âš¡ å‘é€ 10 ä¸ªå¹¶å‘è®¢å•ï¼ˆå±•ç¤ºå¹¶å‘é™æµå’Œé€Ÿç‡é™åˆ¶ï¼‰...

  âœ“ è®¢å• 01 å®Œæˆ - è€—æ—¶: 52ms
  âœ“ è®¢å• 02 å®Œæˆ - è€—æ—¶: 54ms
  âœ“ è®¢å• 03 å®Œæˆ - è€—æ—¶: 56ms
  ...
  âœ“ è®¢å• 10 å®Œæˆ - è€—æ—¶: 78ms

âœ… å®Œæˆ 10/10 ä¸ªè®¢å•
   ï¼ˆæ€§èƒ½ç»„ä»¶æ­£åœ¨å·¥ä½œï¼šå¹¶å‘é™æµã€é€Ÿç‡é™åˆ¶ã€å¹‚ç­‰æ€§ï¼‰

âœ¨ æ‰€æœ‰ç¤ºä¾‹æ‰§è¡Œå®Œæˆï¼
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
OrderProcessing/
â”œâ”€â”€ Commands/           # å‘½ä»¤å®šä¹‰
â”‚   â””â”€â”€ CreateOrderCommand.cs
â”œâ”€â”€ Events/             # äº‹ä»¶å®šä¹‰
â”‚   â””â”€â”€ OrderEvents.cs
â”œâ”€â”€ Handlers/           # å¤„ç†å™¨å®ç°
â”‚   â”œâ”€â”€ CommandHandlers.cs
â”‚   â””â”€â”€ EventHandlers.cs
â”œâ”€â”€ Sagas/              # Saga å®ç°
â”‚   â””â”€â”€ OrderProcessingSaga.cs
â”œâ”€â”€ StateMachines/      # çŠ¶æ€æœºå®ç°
â”‚   â””â”€â”€ OrderStateMachine.cs
â”œâ”€â”€ Services/           # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ BusinessServices.cs
â”œâ”€â”€ Program.cs          # ä¸»ç¨‹åº
â””â”€â”€ OrderProcessing.csproj
```

## ğŸ“ å­¦ä¹ è¦ç‚¹

### CQRS æ¨¡å¼
- ä½¿ç”¨ `IRequest<T>` å®šä¹‰å‘½ä»¤
- ä½¿ç”¨ `IRequestHandler<T, TResponse>` å¤„ç†å‘½ä»¤
- ä½¿ç”¨ `IEvent` å®šä¹‰äº‹ä»¶
- ä½¿ç”¨ `IEventHandler<T>` å¤„ç†äº‹ä»¶

### Saga æ¨¡å¼
- ç»§æ‰¿ `SagaBase<TData>` åˆ›å»º Saga
- å®ç° `SagaStepBase<TData>` åˆ›å»ºæ­¥éª¤
- ä½¿ç”¨ `SagaOrchestrator` ç¼–æ’æ‰§è¡Œæµç¨‹
- è‡ªåŠ¨è¡¥å¿å¤±è´¥çš„æ­¥éª¤

### çŠ¶æ€æœºæ¨¡å¼
- ç»§æ‰¿ `StateMachineBase<TState, TData>` åˆ›å»ºçŠ¶æ€æœº
- ä½¿ç”¨ `ConfigureTransition` é…ç½®çŠ¶æ€è½¬æ¢
- ä½¿ç”¨ `OnEnter/OnExit` æ·»åŠ ç”Ÿå‘½å‘¨æœŸé’©å­
- ä½¿ç”¨ `FireAsync` è§¦å‘äº‹ä»¶

### æ€§èƒ½å’Œå¼¹æ€§
- `AddTransit` é…ç½® Transit é€‰é¡¹
- `WithHighPerformance()` å¯ç”¨é«˜æ€§èƒ½æ¨¡å¼
- `WithResilience()` å¯ç”¨å¼¹æ€§ç»„ä»¶
- è‡ªåŠ¨åº”ç”¨å¹¶å‘é™æµã€é€Ÿç‡é™åˆ¶ç­‰

## ğŸ’¡ æ‰©å±•å»ºè®®

1. **æ·»åŠ éªŒè¯**ï¼šå®ç° `IValidator<TRequest>` è¿›è¡Œè¯·æ±‚éªŒè¯
2. **æ·»åŠ é‡è¯•**ï¼šé…ç½® `RetryBehavior` è‡ªåŠ¨é‡è¯•å¤±è´¥æ“ä½œ
3. **æ·»åŠ è¿½è¸ª**ï¼šå¯ç”¨ `TracingBehavior` è¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ª
4. **æŒä¹…åŒ– Saga**ï¼šå®ç°è‡ªå®šä¹‰ `ISagaRepository` æŒä¹…åŒ–åˆ°æ•°æ®åº“
5. **NATS ä¼ è¾“**ï¼šåˆ‡æ¢åˆ° NATS å®ç°åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Saga å’ŒçŠ¶æ€æœºæ–‡æ¡£](../../docs/SAGA_AND_STATE_MACHINE.md)
- [åŠŸèƒ½å®Œæ•´æ¸…å•](../../docs/FINAL_FEATURES.md)
- [ä¸ MassTransit å¯¹æ¯”](../../docs/COMPARISON_WITH_MASSTRANSIT.md)

